import{r as n,j as s,T as B,M as R,B as q}from"./index-73FoUPY2.js";import{a as Q}from"./index-B9ygI19o.js";/* empty css             */const c=Q.create({baseURL:"",timeout:1e4});async function U(a){return(await c.get("/api/passengers",{params:{userId:a}})).data}async function z(a,t){return(await c.get("/api/passengers/search",{params:{userId:a,q:t}})).data}async function G(a){return(await c.post("/api/passengers",a)).data}async function H(a,t){return(await c.put(`/api/passengers/${a}`,t)).data}async function J(a,t){return(await c.delete(`/api/passengers/${a}`,{params:{userId:t}})).data}const W=()=>{const[a]=n.useState(1),[t,i]=n.useState([]),[_,I]=n.useState(""),[S,P]=n.useState(!1),[y,A]=n.useState(""),[F,d]=n.useState(!1),[C,o]=n.useState(null),[w,h]=n.useState(null),l=async()=>{P(!0),A("");try{const e=await U(a),b=Array.isArray(e.passengers)?e.passengers:[];i(b)}catch{A("加载失败")}finally{P(!1)}};n.useEffect(()=>{l()},[]);const E=n.useMemo(()=>t,[t]),[r,m]=n.useState(""),[x,j]=n.useState(""),[u,p]=n.useState("二代居民身份证"),[g,N]=n.useState(""),[v,f]=n.useState("成人"),k=()=>{m(""),j(""),p("二代居民身份证"),N(""),f("成人")},T=async()=>{r&&(await G({userId:a,name:r,phone:x,id_card_type:u,id_card_number:g,discount_type:v}),d(!1),k(),await l())},L=e=>{o(e),m(e.name||""),j(e.phone||""),p(e.id_card_type||"二代居民身份证"),N(e.id_card_number||""),f(e.discount_type||"成人")},D=async()=>{C&&(await H(C.id,{userId:a,name:r,phone:x,id_card_type:u,id_card_number:g,discount_type:v}),o(null),k(),await l())},M=async()=>{w!=null&&(await J(w,a),h(null),await l())};return s.jsxs("div",{className:"passengers-page",children:[s.jsx(B,{}),s.jsx(R,{}),s.jsxs("div",{className:"page-wrapper",children:[s.jsxs("div",{className:"breadcrumb",children:[s.jsx("a",{href:"javascript:;",className:"crumb",children:"我的12306"}),s.jsx("span",{className:"sep",children:">"}),s.jsx("span",{className:"crumb current",children:"乘车人"})]}),s.jsx("div",{className:"tool-bar",children:s.jsxs("div",{className:"tool-bar-inner",children:[s.jsxs("div",{className:"left-tools",children:[s.jsx("button",{className:"primary",onClick:()=>{k(),d(!0)},children:"新增乘车人"}),s.jsx("button",{className:"ghost",onClick:l,children:"刷新"})]}),s.jsxs("div",{className:"right-tools",children:[s.jsx("input",{className:"search",value:_,onChange:e=>I(e.target.value),placeholder:"姓名/手机号/证件号"}),s.jsx("button",{className:"search-btn",onClick:async()=>{const e=_.trim();if(e)try{const b=await z(a,e),$=Array.isArray(b.passengers)?b.passengers:[];i($)}catch{}},children:"搜索"})]})]})}),s.jsxs("div",{className:"notice",children:[s.jsx("span",{className:"notice-icon",children:"i"}),s.jsx("span",{className:"notice-text",children:" ${unlinkText} "})]}),s.jsxs("div",{className:"list-panel",children:[S&&s.jsx("div",{className:"loading",children:"加载中…"}),y&&s.jsx("div",{className:"error",children:y}),!S&&!y&&s.jsxs("table",{className:"table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"姓名"}),s.jsx("th",{children:"手机号"}),s.jsx("th",{children:"证件类型"}),s.jsx("th",{children:"证件号码"}),s.jsx("th",{children:"优惠类型"}),s.jsx("th",{children:"状态"}),s.jsx("th",{children:"操作"})]})}),s.jsxs("tbody",{children:[E.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"empty",children:"暂无乘车人"})}),E.map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:e.name}),s.jsx("td",{children:e.phone||"-"}),s.jsx("td",{children:e.id_card_type||"-"}),s.jsx("td",{children:e.id_card_number||"-"}),s.jsx("td",{children:e.discount_type||"-"}),s.jsxs("td",{children:[e.status==="已通过"&&s.jsx("span",{className:"tag pass",children:"已通过"}),e.status==="待核验"&&s.jsx("span",{className:"tag pending",children:"待核验"}),e.status==="未通过"&&s.jsx("span",{className:"tag fail",children:"未通过"}),!e.status&&s.jsx("span",{className:"tag unknown",children:"—"})]}),s.jsxs("td",{children:[s.jsx("button",{className:"link",onClick:()=>L(e),children:"编辑"}),s.jsx("span",{className:"split",children:"|"}),s.jsx("button",{className:"link danger",onClick:()=>h(e.id),children:"删除"})]})]},e.id))]})]})]}),F&&s.jsx("div",{className:"dialog-mask",onClick:()=>d(!1),children:s.jsxs("div",{className:"dialog",onClick:e=>e.stopPropagation(),children:[s.jsx("div",{className:"dialog-hd",children:"新增乘车人"}),s.jsxs("div",{className:"dialog-bd",children:[s.jsxs("div",{className:"form-row",children:[s.jsx("label",{children:"姓名"}),s.jsx("input",{value:r,onChange:e=>m(e.target.value)})]}),s.jsxs("div",{className:"form-row",children:[s.jsx("label",{children:"手机号"}),s.jsx("input",{value:x,onChange:e=>j(e.target.value)})]}),s.jsxs("div",{className:"form-row",children:[s.jsx("label",{children:"证件类型"}),s.jsxs("select",{value:u,onChange:e=>p(e.target.value),children:[s.jsx("option",{children:"二代居民身份证"}),s.jsx("option",{children:"护照"}),s.jsx("option",{children:"港澳居民来往内地通行证"}),s.jsx("option",{children:"台湾居民来往大陆通行证"})]})]}),s.jsxs("div",{className:"form-row",children:[s.jsx("label",{children:"证件号码"}),s.jsx("input",{value:g,onChange:e=>N(e.target.value)})]}),s.jsxs("div",{className:"form-row",children:[s.jsx("label",{children:"优惠类型"}),s.jsxs("select",{value:v,onChange:e=>f(e.target.value),children:[s.jsx("option",{children:"成人"}),s.jsx("option",{children:"学生"}),s.jsx("option",{children:"儿童"})]})]})]}),s.jsxs("div",{className:"dialog-ft",children:[s.jsx("button",{className:"primary",onClick:T,children:"确 定"}),s.jsx("button",{className:"ghost",onClick:()=>d(!1),children:"取 消"})]})]})}),C&&s.jsx("div",{className:"dialog-mask",onClick:()=>o(null),children:s.jsxs("div",{className:"dialog",onClick:e=>e.stopPropagation(),children:[s.jsx("div",{className:"dialog-hd",children:"编辑乘车人"}),s.jsxs("div",{className:"dialog-bd",children:[s.jsxs("div",{className:"form-row",children:[s.jsx("label",{children:"姓名"}),s.jsx("input",{value:r,onChange:e=>m(e.target.value)})]}),s.jsxs("div",{className:"form-row",children:[s.jsx("label",{children:"手机号"}),s.jsx("input",{value:x,onChange:e=>j(e.target.value)})]}),s.jsxs("div",{className:"form-row",children:[s.jsx("label",{children:"证件类型"}),s.jsxs("select",{value:u,onChange:e=>p(e.target.value),children:[s.jsx("option",{children:"二代居民身份证"}),s.jsx("option",{children:"护照"}),s.jsx("option",{children:"港澳居民来往内地通行证"}),s.jsx("option",{children:"台湾居民来往大陆通行证"})]})]}),s.jsxs("div",{className:"form-row",children:[s.jsx("label",{children:"证件号码"}),s.jsx("input",{value:g,onChange:e=>N(e.target.value)})]}),s.jsxs("div",{className:"form-row",children:[s.jsx("label",{children:"优惠类型"}),s.jsxs("select",{value:v,onChange:e=>f(e.target.value),children:[s.jsx("option",{children:"成人"}),s.jsx("option",{children:"学生"}),s.jsx("option",{children:"儿童"})]})]})]}),s.jsxs("div",{className:"dialog-ft",children:[s.jsx("button",{className:"primary",onClick:D,children:"保 存"}),s.jsx("button",{className:"ghost",onClick:()=>o(null),children:"取 消"})]})]})}),w!=null&&s.jsx("div",{className:"confirm-mask",onClick:()=>h(null),children:s.jsxs("div",{className:"confirm",onClick:e=>e.stopPropagation(),children:[s.jsx("div",{className:"confirm-hd",children:"删除确认"}),s.jsx("div",{className:"confirm-bd",children:"确定要删除该乘车人吗？"}),s.jsxs("div",{className:"confirm-ft",children:[s.jsx("button",{className:"danger",onClick:M,children:"删 除"}),s.jsx("button",{className:"ghost",onClick:()=>h(null),children:"取 消"})]})]})})]}),s.jsx(q,{})]})};export{W as default};
