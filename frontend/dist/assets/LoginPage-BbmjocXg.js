import{r as a,j as e,u as T}from"./index-73FoUPY2.js";import{P}from"./routes-DmKF3Qpy.js";import{a as L}from"./index-B9ygI19o.js";async function D(o){return(await L.post("/api/auth/login",{identifier:o.identifier||o.username,password:o.password})).data}async function I(o){return(await L.post("/api/auth/send-verification-code",o)).data}async function V(o){return(await L.post("/api/auth/verify-login",o)).data}function $(){const o=i=>!i||i.trim()==="",d=(i,g)=>i.length>=g;return{validateLogin:(i,g)=>o(i)?"è¯·è¾“å…¥ç”¨æˆ·åï¼":o(g)?"è¯·è¾“å…¥å¯†ç ï¼":d(g,6)?"":"å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½ï¼"}}const F=({onSubmit:o,onQrLogin:d,onRegister:j,onForgotPassword:i,onRegisterClick:g,onForgotPasswordClick:l,isLoading:x=!1,error:u})=>{const[S,p]=a.useState(""),[f,N]=a.useState(""),[r,b]=a.useState("account"),[n,C]=a.useState(""),{validateLogin:y}=$();a.useEffect(()=>{u&&N("")},[u]);const k=c=>{if(c.preventDefault(),C(""),r==="account"){const t=y(S,f);if(t){C(t);return}o({identifier:S,password:f})}else r==="qr"&&d&&d()};return e.jsxs("div",{className:"login-form-container",children:[e.jsxs("div",{className:"login-tabs",children:[e.jsx("button",{className:`tab-button ${r==="account"?"active":""}`,onClick:()=>b("account"),children:"è´¦å·ç™»å½•"}),e.jsx("button",{className:`tab-button ${r==="qr"?"active":""}`,onClick:()=>b("qr"),children:"æ‰«ç ç™»å½•"})]}),e.jsxs("form",{className:"login-form",onSubmit:k,role:"form",children:[(u||n)&&e.jsx("div",{className:"error-message",children:n||u}),r==="account"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"form-group",children:e.jsx("input",{type:"text",placeholder:"ç”¨æˆ·å/é‚®ç®±/æ‰‹æœºå·",value:S,onChange:c=>p(c.target.value),className:"form-input",disabled:x})}),e.jsx("div",{className:"form-group",children:e.jsx("input",{type:"password",placeholder:"å¯†ç ",value:f,onChange:c=>N(c.target.value),className:"form-input",disabled:x})})]}),r==="qr"&&e.jsx("div",{className:"qr-login-area",children:e.jsxs("div",{className:"qr-code-container",children:[e.jsx("img",{src:"/images/qr-code.png",alt:"æ‰«ç ç™»å½•",className:"qr-code-image"}),e.jsxs("div",{className:"qr-instructions",children:[e.jsx("p",{children:"æ‰“å¼€é“è·¯12306æ‰‹æœºAPP"}),e.jsx("p",{children:"æ‰«æäºŒç»´ç ç™»å½•"})]})]})}),r!=="qr"&&e.jsx("button",{type:"submit",className:"login-button",disabled:x,children:x?"ç™»å½•ä¸­...":"ç«‹å³ç™»å½•"}),e.jsxs("div",{className:"form-links",children:[e.jsx("button",{type:"button",className:"link-button",onClick:g||j,children:"æ³¨å†Œ12306è´¦æˆ·"}),e.jsx("button",{type:"button",className:"link-button forgot-password-link",onClick:l||i,children:"å¿˜è®°å¯†ç ï¼Ÿ"})]})]})]})},R=({sessionId:o,onClose:d,onSubmit:j,externalError:i="",externalSuccess:g=""})=>{const[l,x]=a.useState(""),[u,S]=a.useState(""),[p,f]=a.useState(0),[N,r]=a.useState(!1),[b,n]=a.useState("");a.useEffect(()=>{if(p>0){const t=setTimeout(()=>{f(p-1)},1e3);return()=>clearTimeout(t)}},[p]);const C=async()=>{var t,m,h,w,v;if(!l||l.length!==4){n("è¯·è¾“å…¥è¯ä»¶å·å4ä½");return}if(r(!0),n(""),console.log("Sending SMS for ID card last 4:",l),!o){f(60),r(!1);return}try{const s=await I({sessionId:o,idCardLast4:l});if((s==null?void 0:s.success)??((t=s==null?void 0:s.data)==null?void 0:t.success)){const q=(s==null?void 0:s.verificationCode)??((m=s==null?void 0:s.data)==null?void 0:m.verificationCode),M=(s==null?void 0:s.phone)??((h=s==null?void 0:s.data)==null?void 0:h.phone);q&&(console.log(`
=================================`),console.log("ğŸ“± ç™»å½•éªŒè¯ç "),console.log(`æ‰‹æœºå·: ${M||"æœªçŸ¥"}`),console.log(`éªŒè¯ç : ${q}`),console.log("æœ‰æ•ˆæœŸ: 5åˆ†é’Ÿ"),console.log(`=================================
`)),f(60)}else n("å‘é€éªŒè¯ç å¤±è´¥")}catch(s){const E=((v=(w=s.response)==null?void 0:w.data)==null?void 0:v.error)||"å‘é€éªŒè¯ç å¤±è´¥ï¼Œè¯·é‡è¯•";n(E)}finally{r(!1)}},y=t=>{if(t.preventDefault(),n(""),!l||l.trim()===""){n("è¯·è¾“å…¥ç™»å½•è´¦å·ç»‘å®šçš„è¯ä»¶å·å4ä½");return}if(l.length!==4){n("è¯·è¾“å…¥ç™»å½•è´¦å·ç»‘å®šçš„è¯ä»¶å·å4ä½");return}if(!u||u.trim()===""){n("è¯·è¾“å…¥éªŒè¯ç ");return}if(u.length<6){n("è¯·è¾“å…¥æ­£ç¡®çš„éªŒè¯ç ");return}j({idCardLast4:l,code:u})},k=t=>{t.target===t.currentTarget&&d()},c=l.length<4||p>0||N;return e.jsx("div",{className:"sms-modal-backdrop",onClick:k,children:e.jsxs("div",{className:"sms-modal",children:[e.jsxs("div",{className:"sms-modal-header",children:[e.jsx("span",{className:"modal-title",children:"é€‰æ‹©éªŒè¯æ–¹å¼"}),e.jsx("button",{className:"close-button",onClick:d,type:"button",children:"Ã—"})]}),e.jsx("div",{className:"verification-type",children:"çŸ­ä¿¡éªŒè¯"}),e.jsxs("form",{className:"sms-modal-form",onSubmit:y,children:[e.jsx("div",{className:"form-group",children:e.jsx("input",{type:"text",placeholder:"è¯·è¾“å…¥ç™»å½•è´¦å·ç»‘å®šçš„è¯ä»¶å·å4ä½",value:l,onChange:t=>{const m=t.target.value.replace(/\D/g,"").slice(0,4);x(m),n("")},maxLength:4,className:"form-input"})}),e.jsx("div",{className:"form-group",children:e.jsxs("div",{className:"code-input-group",children:[e.jsx("input",{type:"text",placeholder:"è¾“å…¥éªŒè¯ç ",value:u,onChange:t=>{const m=t.target.value.replace(/\D/g,"").slice(0,6);S(m),n("")},maxLength:6,className:"form-input code-input"}),e.jsx("button",{type:"button",className:`send-code-button ${c?"disabled":""}`,onClick:C,disabled:c,children:p>0?`é‡æ–°å‘é€(${p}s)`:N?"å‘é€ä¸­...":"è·å–éªŒè¯ç "})]})}),(b||i)&&e.jsx("div",{className:"error-message",children:i||b}),g&&e.jsx("div",{className:"success-message",children:g}),e.jsx("button",{type:"submit",className:"confirm-button",children:"ç¡®å®š"})]})]})})},Q=()=>{const o=T(),[d,j]=a.useState(!1),[i,g]=a.useState(""),[l,x]=a.useState(""),[u,S]=a.useState(!1),[p,f]=a.useState(""),[N,r]=a.useState(""),b=async c=>{var t,m;S(!0),x("");try{const h=await D({identifier:c.identifier,username:c.username,password:c.password});h.success&&(g(h.sessionId),j(!0))}catch(h){console.error("Login error:",h),x(((m=(t=h.response)==null?void 0:t.data)==null?void 0:m.error)||"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{S(!1)}},n=()=>{o(P.register)},C=()=>{console.log("Navigate to forgot password")},y=()=>{j(!1),f(""),r("")},k=async c=>{var t,m,h,w;f(""),r("");try{const v=await V({sessionId:i,idCardLast4:c.idCardLast4,verificationCode:c.code});v.success&&(console.log("SMS verification success:",v),r("ç™»å½•æˆåŠŸï¼"),setTimeout(()=>{j(!1)},2e3))}catch(v){console.error("SMS verification error:",v),console.log("é”™è¯¯å“åº”æ•°æ®:",(t=v.response)==null?void 0:t.data),console.log("é”™è¯¯çŠ¶æ€ç :",(m=v.response)==null?void 0:m.status);const s=((w=(h=v.response)==null?void 0:h.data)==null?void 0:w.error)||"éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•";console.log("æœ€ç»ˆæ˜¾ç¤ºçš„é”™è¯¯ä¿¡æ¯:",s),f(s)}};return e.jsxs("div",{className:"login-page",children:[e.jsx("div",{"data-testid":"top-navigation",onClick:()=>console.log("Logo clicked")}),e.jsxs("div",{className:"login-content",children:[e.jsx("div",{className:"login-promotion"}),e.jsx("div",{className:"login-form-container",children:e.jsx(F,{onSubmit:b,onQrLogin:()=>console.log("QR login"),onRegisterClick:n,onForgotPasswordClick:C,error:l,isLoading:u})})]}),d&&i&&e.jsx(R,{sessionId:i,onClose:y,onSubmit:k,externalError:p,externalSuccess:N}),e.jsx("div",{"data-testid":"bottom-navigation"})]})};export{Q as default};
