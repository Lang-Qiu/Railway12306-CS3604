id: REQ-API-1
name: 首页与查询页面接口规范
functional_description: 旨在为首页及查询页面的站点拣选、日期选定、列车班次检索以及登录、注册、用户中心跳转等功能提供标准化的API协议。
children:
  - id: REQ-API-1-1
    name: 车站相关服务接口
    children:
      - id: REQ-API-1-1-1
        name: 车站清单及检索
        functional_description: |
          - 接口：GET /api/stations
          - 描述：兼容中文、拼音及别名的模糊查找功能。
          - Query参数：
            - query (string, optional)：检索关键词；若未提供则返回所有记录（支持分页获取）。
            - limit (int, optional, default 50)
            - offset (int, optional, default 0)
          - Response data：
            - stations: [{station_id, station_name_cn, station_name_py, alias_list[], station_code}]
          - Errors：VALIDATION_ERROR（参数无效），INTERNAL_ERROR

      - id: REQ-API-1-1-2
        name: 建议相关车站
        functional_description: |
          - 接口：GET /api/stations/recommend
          - 描述：依据输入信息智能推荐近似车站。
          - Query参数：
            - input (string, required)
            - limit (int, optional, default 10)
          - Response data：
            - recommendations: [{station_id, station_name_cn, station_name_py, similarity (0..1)}]
          - Errors：STATION_NOT_FOUND（若无推荐项则返回空集合而不抛出异常）、INTERNAL_ERROR

  - id: REQ-API-1-2
    name: 日期及售票服务接口
    children:
      - id: REQ-API-1-2-1
        name: 可用售票日期列表
        functional_description: |
          - 接口：GET /api/calendar/release-dates
          - 描述：获取当前允许销售车票的日期范围（即已开放售票的日期）。
          - Query参数：
            - from (date, optional)：开始时间；
            - to (date, optional)：截止时间；若两者均缺省，则采用系统预设区间（例如未来N天）。
          - Response data：
            - dates: ["YYYY-MM-DD", ...]
          - Errors：INTERNAL_ERROR

  - id: REQ-API-1-3
    name: 列车班次查询接口
    children:
      - id: REQ-API-1-3-1
        name: 列车班次清单检索
        functional_description: |
          - 接口：GET /api/trains
          - 描述：基于出发站、终点站、出发日期及过滤条件获取列车班次详情。
          - Query参数：
            - from_station_code (string, required)
            - to_station_code (string, required)
            - date (string, required, YYYY-MM-DD)
            - filters (object, optional)：如 {student: bool, high_speed: bool, emu: bool}
          - Response data：
            - trains: [{train_no, train_type, from_station_code, to_station_code, departure_time, arrival_time, duration, seats: [{type, available}], price_range: {min, max}}]
          - Errors：
            - VALIDATION_ERROR（车站或日期无效）
            - NO_TICKETS（未找到匹配车次，直接返回空列表）
            - INTERNAL_ERROR（检索请求失败）

  - id: REQ-API-1-4
    name: 身份验证及用户中心接口
    children:
      - id: REQ-API-1-4-1
        name: 账户登录
        functional_description: |
          - 接口：POST /api/auth/login
          - Body：{username: string, password: string}
          - Response data：{token: string, user: {user_id, nickname}}
          - Errors：AUTH_INVALID（账号或密码错误）、INTERNAL_ERROR

      - id: REQ-API-1-4-2
        name: 账户注册
        functional_description: |
          - 接口：POST /api/auth/register
          - Body：{username: string, password: string, phone?: string, sms_code?: string}
          - Response data：{user_id, nickname}
          - Errors：USER_EXISTS、VALIDATION_ERROR、INTERNAL_ERROR

      - id: REQ-API-1-4-3
        name: 读取当前用户资料
        functional_description: |
          - 接口：GET /api/users/me
          - Headers：Authorization: Bearer <token>
          - Response data：{user_id, nickname, phone?, email?}
          - Errors：AUTH_REQUIRED、INTERNAL_ERROR

  - id: REQ-API-1-5
    name: 错误代码与提示语对应关系
    functional_description: |
      - VALIDATION_ERROR → “未能匹配指定的出发或到达地点”或相应的字段验证提醒
      - AUTH_INVALID → “登录操作未成功，请稍后再试”（针对特定账号错误可提供详细说明）
      - AUTH_REQUIRED → “请务必先登录12306账户！”
      - INTERNAL_ERROR → “查询操作未成功，请稍后再试”或“跳转至个人中心失败，请稍后再试”等情境下的提示信息
      - USER_EXISTS → “注册操作未成功，请稍后再试”（可根据文案策略具体化为“用户已存在”）

  - id: REQ-API-1-6
    name: 接口验证与安全防护（推荐）
    functional_description: |
      - 输入黑白名单机制：校验车站代码、验证日期格式、剔除违规字符；
      - 频率限制：预防恶意暴力请求；
      - 异常防护：部署统一的错误处理中间层；
      - 可观测性设计：对核心接口进行埋点与耗时监控，以追踪是否满足100毫秒的用户体验指标。
