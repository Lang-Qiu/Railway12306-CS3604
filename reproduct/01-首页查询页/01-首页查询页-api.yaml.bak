id: REQ-API-1
name: 首页/查询页 接口设计
functional_description: 为首页/查询页的站点选择、日期选择、车次查询及登录/注册/个人中心跳转提供统一的API契约。
children:
  - id: REQ-API-1-1
    name: 站点相关接口
    children:
      - id: REQ-API-1-1-1
        name: 站点列表与搜索
        functional_description: |
          - 接口：GET /api/stations
          - 描述：支持中文/拼音/别名模糊匹配。
          - Query参数：
            - query (string, optional)：搜索关键字；为空时返回全部（可分页）。
            - limit (int, optional, default 50)
            - offset (int, optional, default 0)
          - Response data：
            - stations: [{station_id, station_name_cn, station_name_py, alias_list[], station_code}]
          - Errors：VALIDATION_ERROR（非法参数），INTERNAL_ERROR

      - id: REQ-API-1-1-2
        name: 推荐相似站点
        functional_description: |
          - 接口：GET /api/stations/recommend
          - 描述：根据输入内容推荐相似站点。
          - Query参数：
            - input (string, required)
            - limit (int, optional, default 10)
          - Response data：
            - recommendations: [{station_id, station_name_cn, station_name_py, similarity (0..1)}]
          - Errors：STATION_NOT_FOUND（无推荐时返回空数组但不报错）、INTERNAL_ERROR

  - id: REQ-API-1-2
    name: 日期与放票接口
    children:
      - id: REQ-API-1-2-1
        name: 可售日期集合
        functional_description: |
          - 接口：GET /api/calendar/release-dates
          - 描述：返回可售日期集合（已放票的日期）。
          - Query参数：
            - from (date, optional)：起始日期；
            - to (date, optional)：结束日期；若均为空，返回系统默认范围（如接下来N天）。
          - Response data：
            - dates: ["YYYY-MM-DD", ...]
          - Errors：INTERNAL_ERROR

  - id: REQ-API-1-3
    name: 车次查询接口
    children:
      - id: REQ-API-1-3-1
        name: 车次列表查询
        functional_description: |
          - 接口：GET /api/trains
          - 描述：根据出发地、到达地、日期与筛选项返回车次列表。
          - Query参数：
            - from_station_code (string, required)
            - to_station_code (string, required)
            - date (string, required, YYYY-MM-DD)
            - filters (object, optional)：如 {student: bool, high_speed: bool, emu: bool}
          - Response data：
            - trains: [{train_no, train_type, from_station_code, to_station_code, departure_time, arrival_time, duration, seats: [{type, available}], price_range: {min, max}}]
          - Errors：
            - VALIDATION_ERROR（站点或日期不合法）
            - NO_TICKETS（无符合条件车次，返回空列表即可）
            - INTERNAL_ERROR（查询失败）

  - id: REQ-API-1-4
    name: 认证与用户中心接口
    children:
      - id: REQ-API-1-4-1
        name: 用户登录
        functional_description: |
          - 接口：POST /api/auth/login
          - Body：{username: string, password: string}
          - Response data：{token: string, user: {user_id, nickname}}
          - Errors：AUTH_INVALID（账号或密码错误）、INTERNAL_ERROR

      - id: REQ-API-1-4-2
        name: 用户注册
        functional_description: |
          - 接口：POST /api/auth/register
          - Body：{username: string, password: string, phone?: string, sms_code?: string}
          - Response data：{user_id, nickname}
          - Errors：USER_EXISTS、VALIDATION_ERROR、INTERNAL_ERROR

      - id: REQ-API-1-4-3
        name: 获取当前用户信息
        functional_description: |
          - 接口：GET /api/users/me
          - Headers：Authorization: Bearer <token>
          - Response data：{user_id, nickname, phone?, email?}
          - Errors：AUTH_REQUIRED、INTERNAL_ERROR

  - id: REQ-API-1-5
    name: 错误码与文案映射
    functional_description: |
      - VALIDATION_ERROR → “无法匹配该出发地/到达地”或对应字段校验提示
      - AUTH_INVALID → “登录失败，请稍后重试”（具体账号错误可细化）
      - AUTH_REQUIRED → “请先登录12306账号！”
      - INTERNAL_ERROR → “查询失败，请稍后重试”或“前往个人中心失败，请稍后重试”等场景提示
      - USER_EXISTS → “注册失败，请稍后重试”（可细化为“用户已存在”视具体文案策略）

  - id: REQ-API-1-6
    name: 接口校验与防护（建议）
    functional_description: |
      - 输入白/黑名单：站点编码校验、日期格式校验、过滤非法字符；
      - 速率限制：防止暴力请求；
      - 异常保护：统一错误处理中间件；
      - 可观测性：关键接口打点与耗时记录，用于满足100ms体验要求的追踪。
