# 12306 自动化测试与系统实现 - 期末汇报 PPT 提纲

## 1. 汇报概况
- **主题**：基于 LLM 驱动与 WebTestPilot 的 12306 自动化测试系统
- **时长**：10分钟汇报 + 3分钟问答
- **核心亮点**：
    1. **原子级需求管理**：200+ 细分需求的全链路追踪。
    2. **闭环迭代设计**：PRD与代码的双向修正机制。
    3. **工程化AI治理**：解决模型幻觉与数据污染的实战方案。

---

## 2. 演示环节 (Demo) [3分钟]
> *“Talk is cheap, show me the code.”*

### 2.1 核心业务流程演示
- **购票全流程**：`注册/登录` -> `车票查询` -> `选择乘客` -> `提交订单` -> `模拟支付`。
- **验证点**：展示后端 API 的实时响应与数据库的数据变更，证明业务逻辑的真实性。

### 2.2 自动化测试演示
- **脚本执行**：运行 `run_tests.py`，展示自动化测试如何驱动浏览器模拟真实用户操作。
- **效果**：不仅展示功能实现，更直观呈现“测试驱动开发 (TDD)”的成果。

---

## 3. 需求管理 (Requirements Management)
> *“从宏观到微观的精准把控”*

### 3.1 需求分层管理体系
采用“宏观业务-中观功能-微观步骤”的三层管理模型：
- **L1 业务模块**：**5** 大核心模块（查、订、付、注、人）。
- **L2 功能特性**：**30** 个功能单元（如“筛选商务座”、“密码强度校验”）。
- **L3 细分需求点**：**200+** 个原子需求（将测试步骤拆解为“条件-操作-预期”的最小单元）。

### 3.2 细分需求数量分布
| 业务模块 | 细分需求数 | 典型原子需求示例 |
| :--- | :--- | :--- |
| **车票查询** | **103** 个 | 点击“出发地”弹出面板 / 勾选“高铁”实时过滤 / 空结果友好提示 |
| **注册/登录** | **58** 个 | 密码强度校验 / 必填项空值拦截 / 隐私条款强制勾选 |
| **乘客管理** | **30** 个 | 身份证校验位算法 / 防止重复添加 / 删除二次确认 |
| **订单/支付** | **7** 个 | 库存校验 / 支付倒计时 / 超时自动取消 |
| **总计** | **200+** 个 | **覆盖 UI 交互、逻辑校验、数据流转全链路** |

---

## 4. 设计思路：PRD 闭环迭代 (Design Methodology)
> *“文档不是死文件，而是活的真理来源”*

### 4.1 核心流程：PRD 驱动 + 反馈修正
不仅仅是线性的 Waterfall，而是一个动态修正闭环：
1.  **PRD 1.0**：定义初始需求与验收标准。
2.  **初稿实现**：LLM 基于 PRD 生成代码初稿。
3.  **问题发现**：通过测试发现逻辑漏洞（如“未校验密码一致性”）。
4.  **Prompt 修正与反哺**：
    *   **修正代码**：设计 Prompt 修复 Bug。
    *   **修正 PRD**：**（核心创新）** 将发现的问题反向更新到 PRD 中，确保文档与代码同步进化。
5.  **测试验证**：基于修正后的 PRD 更新测试用例，达成稳定复现。

### 4.2 全链路可追踪性 (Traceability)
通过 **REQ-ID** 绑定一切：
*   `REQ-ORDER-SUBMIT` (需求)
    *   -> `UI-ORDER-SUBMIT` (前端)
    *   -> `API-POST-ORDER` (后端)
    *   -> `orders-submit-order.json` (测试)

---

## 5. 挑战与解决方案 (Challenges & Solutions)
> *“LLM 时代的工程化反思：如何驯服 AI”*

### 5.1 挑战一：模型幻觉与不可控 (Hallucination)
- **挑战**：试图让 AI 直接生成“完整订单模块”时，常出现逻辑断层、臆造 API、代码无法运行。
- **解决方案**：
    1.  **原子化拆解 (Atomic Decomposition)**：放弃端到端生成，拆解为 `createOrder` 等原子函数逐个生成。
    2.  **接口先行 (Interface First)**：**强制约束** AI 必须严格遵循预定义的 YAML 接口签名，给 AI 戴上“镣铐”。

### 5.2 挑战二：数据库管理混乱 (Database Chaos)
- **挑战**：AI 喜欢随意修改 Schema（改表名/字段名），或插入大量脏数据（Mock 数据），导致测试环境污染。
- **解决方案**：
    1.  **测试环境沙箱化 (Sandbox)**：实现“测试即重置”，每次测试前通过脚本重置 SQLite/JSON DB 为黄金快照。
    2.  **Schema 锁定**：明确指令禁止 AI 修改表结构，只允许 DML 操作，并通过 DAL 层隔离数据库访问。

### 5.3 挑战三：GUI 测试的不稳定性 (Flakiness)
- **挑战**：页面渲染延迟导致元素定位失败。
- **解决方案**：在测试执行器中实现**自动重试机制 (Retry Logic)**，大幅提升 CI 稳定性。

---

## 6. GUI 测试运行情况 (Test Status)
- **覆盖范围**：100% 覆盖 12306 核心业务流程。
- **运行结果**：核心流程测试 **PASS**，异常场景（如输入校验）均已通过。
- **数据支撑**：
    -   管理需求点：**36** 个系统级 ID
    -   自动化用例：**60** 个 JSON 脚本
    -   原子需求覆盖：**200+** 个

---
*文档生成时间：2025-12-28*
